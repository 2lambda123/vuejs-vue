# 最佳实践

## 1. 为列表渲染设置属性key
在虚拟DOM算法中，提高遍历新老节点的效率。

## 2. 路由切换组件不变
比如路由从`/detail/1`切换到`/detail/2`时，组件的生命周期不会重新触发。

解决方法：
- 路由导航beforeRouteUpdate（推荐）；
- 监听路由变化(`watch: { $route.query.id() {} }`)；
- 为router-view组件添加属性key；
```jsx
<router-view :key="$route.fullPath"></router-view>
```

## 3. 为所有路由统一添加query

解决方法：
- 使用全局守卫beforeEach；
```jsx
const query = { referer: '123' }
router.beforeEach((to, from, next) => {
  to.query.referer 
    ? next()
    : next({...to, query: {...to.query, ...query}})
})
// 缺点：每次切换路由，beforeEach都会执行两次
```
- 使用函数劫持
```jsx
const query = { referer: '123' }
const transitionTo = router.history.transitionTo

router.history.transitionTo = function(location, onComplete, onAbort) {
  location = typeof location === 'object'
    ? {...location, query: {...location.query, ...query}}
    : {path: location, query}
  transitionTo.call(router.history, location, onComplete, onAbort)
}
```

## 4. 区分Vuex与props的使用边界
通常，业务组件会使用Vuex的Store存取状态，通用组件使用props以及事件进行父子组件通信，要与业务解耦。
